#!/bin/sh
clear 
echo Starting at `date`

go=8

echo running for Si
echo Starting at `date`

PSEUDO_DIR=.
PSEUDO="Si.pbesol-n-rrkjus_psl.1.0.0.UPF"
TMP_DIR=./tmp
BIN="/home/bienvenue/Documents/DFPT+U/dfptu_git_03.07.2016/bin"
RUN="mpirun -np $go $BIN"

rm -rf TMP_DIR/*

#self-consistent calculation
cat > ./inputs/si.scf.in << EOF
 &control
    calculation='scf',
    restart_mode='from_scratch',
    prefix='si'
    pseudo_dir = '$PSEUDO_DIR/',
    outdir='$TMP_DIR/'
 /
 &system
    ibrav = 2, celldm(1) =10.20, nat=  2, ntyp= 1,
    ecutwfc = 80.0,
    ecutrho = 600.0,
 /
 &electrons
    mixing_beta = 0.7
    conv_thr =  1.0d-8
 /
ATOMIC_SPECIES
 Si  28.086  Si.pbesol-n-rrkjus_psl.1.0.0.UPF
ATOMIC_POSITIONS
 Si 0.00 0.00 0.00
 Si 0.25 0.25 0.25
K_POINTS {automatic}
 12 12 12 0 0 0
EOF

echo "  running the scf calculation for Si..."
$RUN/pw.x < ./inputs/si.scf.in > ./outputs/si.scf.out

# phonon calculation at Gamma
cat > ./inputs/si.phG.in << EOF
phonons of Si at Gamma
 &inputph
  tr2_ph=1.0d-14,
  prefix='si',
  epsil=.true.,
  amass(1)=28.08,
  outdir='$TMP_DIR/',
  fildyn='si.dynG',
 /
0.0 0.0 0.0
EOF

echo " running the Gamma phonons "
$RUN/ph.x < ./inputs/si.phG.in > ./outputs/si.phG.out

cat > ./inputs/si.phX.in << EOF
phonons of si at X
 &inputph
  tr2_ph=1.0d-14,
  prefix='si',
  amass(1)=28.08,
  outdir='$TMP_DIR/',
  fildyn='si.dynX',
 /
1.0 0.0 0.0
EOF

echo " running the X phonons "
$RUN/ph.x < ./inputs/si.phX.in > ./outputs/si.phX.out


echo Ended at `date`
